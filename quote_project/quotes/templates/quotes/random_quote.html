<!DOCTYPE html>
<html>
<head>
    <title>–°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .quote { background: #f9f9f9; padding: 20px; margin: 20px 0; border-left: 5px solid #ccc; }
        .actions { margin: 10px 0; }
        .btn { padding: 5px 15px; margin: 0 5px; cursor: pointer; }
        .like { background: #4CAF50; color: white; }
        .dislike { background: #f44336; color: white; }
        .disabled { opacity: 0.5; cursor: not-allowed; }
        .nav { margin: 20px 0; }
        .message { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>–°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞</h1>
    
    <div class="nav">
        <a href="{% url 'add_quote' %}">–î–æ–±–∞–≤–∏—Ç—å —Ü–∏—Ç–∞—Ç—É</a> |
        <a href="{% url 'add_source' %}">–î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫</a> |
        <a href="{% url 'popular_quotes' %}">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã</a>
    </div>

    {% if quote %}
    <div class="quote">
        <p>"{{ quote.text }}"</p>
        <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫:</strong> {{ quote.source }}</p>
        <p><strong>–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤:</strong> {{ quote.views_count }}</p>
        <p><strong>–õ–∞–π–∫–∏:</strong> <span id="likes-count">{{ quote.likes }}</span></p>
        <p><strong>–î–∏–∑–ª–∞–π–∫–∏:</strong> <span id="dislikes-count">{{ quote.dislikes }}</span></p>
    </div>
    
    <div class="actions">
        <button class="btn like {% if user_voted %}disabled{% endif %}" 
                onclick="likeQuote({{ quote.id }})" 
                {% if user_voted %}disabled{% endif %}>
            üëç
        </button>
        <button class="btn dislike {% if user_voted %}disabled{% endif %}" 
                onclick="dislikeQuote({{ quote.id }})" 
                {% if user_voted %}disabled{% endif %}>
            üëé
        </button>
    </div>
    
    <div id="message" class="message" style="display: none;"></div>
    
    {% else %}
    <p>–¶–∏—Ç–∞—Ç –ø–æ–∫–∞ –Ω–µ—Ç. <a href="{% url 'add_quote' %}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</a></p>
    {% endif %}

    <p>–í—Å–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: {{ total_views }}</p>

    <script>
    function showMessage(text, type) {
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = text;
        messageDiv.className = `message ${type}`;
        messageDiv.style.display = 'block';
        
        setTimeout(() => {
            messageDiv.style.display = 'none';
        }, 3000);
    }
    
    function likeQuote(quoteId) {
        fetch(`/like/${quoteId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('likes-count').textContent = data.likes;
                    document.getElementById('dislikes-count').textContent = data.dislikes;
                    
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
                    document.querySelectorAll('.btn').forEach(btn => {
                        btn.classList.add('disabled');
                        btn.disabled = true;
                    });
                    
                    showMessage('–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –≥–æ–ª–æ—Å!', 'success');
                } else {
                    showMessage(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏', 'error');
                }
            })
            .catch(error => {
                showMessage('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            });
    }
    
    function dislikeQuote(quoteId) {
        fetch(`/dislike/${quoteId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('likes-count').textContent = data.likes;
                    document.getElementById('dislikes-count').textContent = data.dislikes;
                    
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
                    document.querySelectorAll('.btn').forEach(btn => {
                        btn.classList.add('disabled');
                        btn.disabled = true;
                    });
                    
                    showMessage('–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –≥–æ–ª–æ—Å!', 'success');
                } else {
                    showMessage(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏', 'error');
                }
            })
            .catch(error => {
                showMessage('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            });
    }
    </script>
</body>
</html>